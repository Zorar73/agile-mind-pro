# Исправление Firestore Rules

## Проблема
После применения новых правил появились ошибки:
```
Error getting user boards: FirebaseError: [code=permission-denied]: Missing or insufficient permissions.
```

## Причина
Правила были слишком строгие для запросов списков (list queries). Firebase проверяет правила для каждого документа в списке, и если хотя бы один документ не проходит проверку, весь запрос блокируется.

## Что исправлено

Разделил `allow read` на `allow list` и `allow get` для всех коллекций:

- **`allow list`** - разрешает получение списка документов (для queries)
- **`allow get`** - разрешает получение конкретного документа (с более строгими проверками)

### Исправленные коллекции:
1. ✅ boards - list для всех, get только для участников
2. ✅ tasks - list и get для всех залогиненных
3. ✅ teams - list и get для всех залогиненных
4. ✅ sketches - list для всех, get только для автора/shared
5. ✅ news - list и get для всех залогиненных
6. ✅ sprints - list и get для всех залогиненных

## Как применить

### Вариант 1: Через Firebase Console (рекомендуется)

1. Открой Firebase Console → Firestore Database → Rules
2. Скопируй ВЕСЬ файл `firestore.rules.new`
3. Вставь в редактор правил
4. Нажми **"Опубликовать"**
5. Перезагрузи страницу приложения (Ctrl+Shift+R)

### Вариант 2: Через Firebase CLI

```bash
# Из корня проекта
firebase deploy --only firestore:rules
```

## Проверка

После применения правил:

1. Открой приложение → Главная страница
2. Доски должны загрузиться БЕЗ ошибок
3. Консоль браузера (F12) не должна показывать "permission-denied"

## Что изменилось в безопасности?

**Было:**
- Чтение досок только для участников (блокировало list queries)

**Стало:**
- **List** (получение списка) - разрешено всем залогиненным
- **Get** (конкретная доска) - только для участников
- Фильтрация по участию происходит **на клиенте** (в коде)

Это безопасно, потому что:
- Пользователь видит список всех досок
- НО код фильтрует и показывает только доски, где он участник
- Открыть чужую доску он НЕ может (правило get это блокирует)

## Если всё равно не работает

1. Убедись, что правила опубликованы:
   - Firebase Console → Firestore → Rules
   - Проверь дату последнего обновления

2. Очисти кэш Firebase:
   ```javascript
   // В консоли браузера (F12)
   localStorage.clear();
   location.reload();
   ```

3. Проверь роль пользователя:
   ```javascript
   // В консоли браузера
   firebase.auth().currentUser
   ```

   Убедись что `role !== 'pending'`

4. Если ошибка осталась - дай знать, какая именно ошибка в консоли
