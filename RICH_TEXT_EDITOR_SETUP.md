# Rich Text Editor Setup

## Установка зависимостей

Для работы Rich Text редактора с поддержкой вставки изображений необходимо установить `react-quill`:

```bash
npm install react-quill
```

## Что было реализовано

### 1. Компонент RichTextEditor
- **Файл**: `src/components/Common/RichTextEditor.jsx`
- **Возможности**:
  - Форматирование текста (жирный, курсив, подчеркивание, зачеркивание)
  - Заголовки (H1-H6)
  - Списки (нумерованные и маркированные)
  - Цитаты и блоки кода
  - Цвета текста и фона
  - Выравнивание текста
  - **Вставка изображений** с автоматической загрузкой в Cloudinary
  - Вставка ссылок и видео
  - Отступы
  - Очистка форматирования

### 2. Интеграция с Cloudinary
- Изображения автоматически загружаются в Cloudinary при вставке
- Папка загрузки: `lessons/content`
- Показывается индикатор загрузки во время upload

### 3. Обновленные компоненты

#### LessonManagementPage
- Заменен обычный TextField на RichTextEditor для поля "Содержание урока"
- Увеличен размер диалога до `maxWidth="lg"`
- Добавлена очистка HTML тегов в preview списка уроков

#### LessonPage
- Добавлено отображение HTML контента с `dangerouslySetInnerHTML`
- Добавлены стили для всех элементов HTML (заголовки, списки, изображения, код, цитаты)
- Изображения адаптивны (max-width: 100%)
- Добавлен импорт стилей Quill

## Как использовать

### Для администраторов (создание уроков):

1. Перейти в "Управление курсами" → выбрать курс → "Уроки"
2. Нажать "Добавить урок" или редактировать существующий
3. В поле "Содержание урока" использовать редактор:
   - Форматировать текст через панель инструментов
   - Вставлять изображения через кнопку с иконкой изображения
   - Выбрать файл → изображение автоматически загрузится и вставится в текст

### Для студентов (просмотр уроков):

- Весь контент отображается с сохранением форматирования
- Изображения адаптируются под размер экрана
- Ссылки кликабельны
- Код отображается с подсветкой фона

## Технические детали

### Структура контента
- Контент сохраняется в базе данных как HTML
- При отображении HTML безопасно рендерится через `dangerouslySetInnerHTML`
- HTML очищается от тегов в preview для лучшего UX

### Стили
- Используется класс `ql-editor` для консистентного отображения
- Кастомные стили MUI для всех HTML элементов
- Адаптивные изображения

### Безопасность
- Cloudinary обрабатывает валидацию изображений
- HTML рендерится только из доверенного источника (база данных)
- Нет возможности выполнения JavaScript в контенте

## Расширение функционала

### Добавление поддержки других форматов файлов
Измените функцию `imageHandler` в `RichTextEditor.jsx`:
```javascript
input.setAttribute('accept', 'image/*,application/pdf'); // Добавить PDF
```

### Кастомизация панели инструментов
Измените массив `container` в `modules.toolbar`:
```javascript
container: [
  [{ 'header': [1, 2, 3, false] }], // Только H1-H3
  ['bold', 'italic'], // Только основное форматирование
  ['image'], // Только изображения
]
```

### Изменение папки загрузки
В функции `uploadToCloudinary`:
```javascript
formData.append('folder', 'custom/folder/path');
```

## Troubleshooting

### Изображения не загружаются
1. Проверьте настройки Cloudinary в `.env`:
   ```
   VITE_CLOUDINARY_CLOUD_NAME=your_cloud_name
   ```
2. Убедитесь, что upload preset настроен в Cloudinary Dashboard
3. Проверьте консоль браузера на ошибки

### Стили отображаются некорректно
1. Убедитесь, что импорт стилей есть в LessonPage:
   ```javascript
   import 'react-quill/dist/quill.snow.css';
   ```
2. Проверьте, что класс `ql-editor` применен к контейнеру

### Редактор слишком маленький
Увеличьте размер диалога или добавьте минимальную высоту:
```javascript
<RichTextEditor
  value={value}
  onChange={onChange}
  style={{ minHeight: '400px' }}
/>
```
